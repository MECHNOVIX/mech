<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AR Trial</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:black;
  overflow:hidden;
  font-family:system-ui;
}

/* Video & Canvas */
video,canvas{
  position:fixed;
  top:0;left:0;
  width:100%;
  height:100%;
  object-fit:cover;
  display:none;
}

/* Controls */
.controls{
  position:fixed;
  top:12px;
  right:12px;
  display:none;
  gap:8px;
  z-index:20;
}

.controls button{
  padding:8px 12px;
  border-radius:20px;
  border:none;
  background:rgba(0,0,0,0.6);
  color:white;
}

/* Products */
.products{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  display:none;
  gap:10px;
  z-index:20;
}

.products button{
  padding:10px 14px;
  border-radius:20px;
  border:none;
  background:white;
  font-weight:600;
}
</style>
</head>

<body>

<div class="controls" id="controls">
  <button onclick="switchCamera()">Switch</button>
  <button onclick="stopTrial()"><A href="index.html">‚ùå </A></button>
</div>

<div class="products" id="products">
  <button onclick="setProduct(0)">t shirt</button>
  <button onclick="setProduct(1)">Armor</button>
  <button onclick="setProduct(2)">Kurti</button>
</div>

<video id="video" autoplay muted playsinline></video>
<canvas id="canvas"></canvas>

<!-- MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const video=document.getElementById("video");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

canvas.width=innerWidth;
canvas.height=innerHeight;

let camera=null;
let currentCamera="user";
let faceDetected=false;

/* Products */
const productImgs=[
 "aa.png",
 "https://i.imgur.com/9XnQZ8P.png",
 "vv.png"
];
const bodyImg=new Image();
bodyImg.src=productImgs[0];

function setProduct(i){ bodyImg.src=productImgs[i]; }

/* Face */
const faceMesh=new FaceMesh({
 locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${f}`
});
faceMesh.setOptions({maxNumFaces:1,minDetectionConfidence:.6});
faceMesh.onResults(r=>faceDetected=r.multiFaceLandmarks.length>0);

/* Pose */
const pose=new Pose({
 locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${f}`
});
pose.setOptions({
 modelComplexity:1,
 smoothLandmarks:true,
 minDetectionConfidence:.6,
 minTrackingConfidence:.6
});

pose.onResults(res=>{
 ctx.clearRect(0,0,canvas.width,canvas.height);
 if(!faceDetected||!res.poseLandmarks)return;

 const lm=res.poseLandmarks;
 const neckX=(lm[11].x+lm[12].x)/2*canvas.width;
 const neckY=(lm[11].y+lm[12].y)/2*canvas.height;
 const footY=Math.max(lm[27].y,lm[28].y)*canvas.height;
 const width=Math.abs(lm[11].x-lm[12].x)*canvas.width*2.3;
 const height=footY-neckY;

 ctx.drawImage(bodyImg,neckX-width/2,neckY,width,height);
});

/* AUTO START */
function startTrial(){
 document.getElementById("controls").style.display="flex";
 document.getElementById("products").style.display="flex";

 video.style.display="block";
 canvas.style.display="block";

 camera=new Camera(video,{
   onFrame:async()=>{
     await faceMesh.send({image:video});
     await pose.send({image:video});
   },
   facingMode:currentCamera,
   width:1280,
   height:720
 });
 camera.start();
}

function stopTrial(){
 if(camera)camera.stop();
 ctx.clearRect(0,0,canvas.width,canvas.height);
 video.style.display="none";
 canvas.style.display="none";
 document.getElementById("controls").style.display="none";
 document.getElementById("products").style.display="none";
}

function switchCamera(){
 currentCamera=currentCamera==="user"?"environment":"user";
 stopTrial();
 startTrial();
}

/* Start automatically when page loads */
window.onload=startTrial;
</script>

</body>
</html>